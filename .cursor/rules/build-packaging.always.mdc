---
description: "Build and packaging requirements for MagicOptimizer plugin development"
alwaysApply: true
---

# Build and Packaging - Always Apply

## ğŸ”¨ **CRITICAL: Multi-DLL Plugin Architecture**

### **UE5 Plugin Reality**
UE5 plugins often have multiple DLLs that MUST be rebuilt together:

```cpp
// âŒ WRONG: Partial rebuilds cause "ghost" behavior
// Old code still runs, debugging becomes impossible

// âœ… CORRECT: Rebuild ALL plugin DLLs together
// Check build timestamps match across all plugin DLLs
```

### **Required Build Steps**
1. **Clean plugin Binaries and Intermediate** before building
2. **Rebuild ALL plugin modules** together
3. **Verify build timestamps match** across all plugin DLLs
4. **Check file sizes** to ensure complete rebuilds

## ğŸ—ï¸ **Build Configuration**

### **Module Dependencies**
```cpp
// âœ… CORRECT: Runtime module dependencies
PublicDependencyModuleNames.AddRange({
    "Core",
    "CoreUObject", 
    "Engine"
});

// âœ… CORRECT: Editor module dependencies (Private only)
PrivateDependencyModuleNames.AddRange({
    "EditorStyle",
    "UnrealEd"
});
```

### **PCH Usage**
```cpp
// âœ… CORRECT: Use explicit or shared PCHs
PCHUsage = PCHUsageMode.UseExplicitOrSharedPCHs;

// âŒ WRONG: Default PCH usage
PCHUsage = PCHUsageMode.Default;
```

## ğŸ“¦ **Packaging Requirements**

### **Canonical Entry Point**
```bash
# âœ… CORRECT: Use the official packaging script
Scripts/PackagePlugin.ps1

# âŒ WRONG: Manual packaging commands
RunUAT BuildPlugin -Plugin="..." -Package="..."
```

### **Windows Packaging**
```bash
# âœ… CORRECT: Avoid host rules scans
Scripts/PackagePlugin.ps1 -NoHostPlatform

# âŒ WRONG: Default packaging on Windows
Scripts/PackagePlugin.ps1
```

### **Pre-Packaging Checklist**
- âœ… **Clean Binaries/Intermediate** directories
- âœ… **Regenerate project files** if modules changed
- âœ… **Verify plugin descriptor** is correct
- âœ… **Check FilterPlugin.ini** excludes dev content

## ğŸ” **Build Validation**

### **Post-Build Verification**
1. **Check all plugin DLLs** were rebuilt
2. **Verify build timestamps** match across modules
3. **Test plugin loads** in editor
4. **Check for UHT/UBT warnings** (treat as errors)

### **Common Build Issues**
```cpp
// âŒ SYMPTOM: "Plugin not found" errors
// âŒ CAUSE: Missing or incorrect .uplugin file
// âœ… SOLUTION: Verify plugin descriptor and module paths

// âŒ SYMPTOM: Linker errors
// âŒ CAUSE: Missing dependencies or incorrect module names
// âœ… SOLUTION: Check PublicDependencyModuleNames and PrivateDependencyModuleNames
```

## ğŸ“ **Output Management**

### **Package Output Location**
```
HostProject/Artifacts/                    # Package output directory
â”œâ”€â”€ MagicOptimizer-v1.0.0.zip            # Packaged plugin
â”œâ”€â”€ MagicOptimector-v1.0.0/              # Extracted package
â””â”€â”€ BuildLogs/                            # Build artifacts
```

### **Version Management**
- **Update CHANGELOG** before packaging
- **Bump Version fields** in plugin descriptor
- **Tag releases** in git after successful packaging
- **Store packaged output** under Artifacts directory

## âš ï¸ **Build Pitfalls**

### **Ghost Code Trap**
```cpp
// âŒ SYMPTOM: Old code still runs after "fixes"
// âŒ CAUSE: Partial rebuilds, mismatched DLL timestamps
// âœ… SOLUTION: Rebuild ALL plugin DLLs together
```

### **Module Boundary Violations**
```cpp
// âŒ SYMPTOM: Editor code in runtime module
// âŒ CAUSE: Missing WITH_EDITOR guards
// âœ… SOLUTION: Use WITH_EDITOR guards for editor-only code
```

## ğŸ¯ **Success Metrics**

- âœ… **All plugin DLLs rebuilt** together
- âœ… **Build timestamps match** across modules
- âœ… **No UHT/UBT warnings** (clean build)
- âœ… **Plugin loads successfully** in editor
- âœ… **Packaging completes** without errors
- âœ… **Version fields updated** before packaging
- âœ… **Artifacts stored** in correct location
description:
globs:
alwaysApply: false
---
