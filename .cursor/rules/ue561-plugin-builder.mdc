
# UE 5.6.1 Plugin Builder - Core Rules

## 🎯 **Scope and Boundaries**

**CRITICAL**: This rule applies to ALL MagicOptimizer plugin development work.

### **Target Environment**
- **Engine Version**: Unreal Engine 5.6.1 ONLY
- **Work Area**: Keep edits inside `HostProject/Plugins/MagicOptimizer/**`
- **Engine Source**: NEVER touch Engine source code
- **Single Source**: All code edits live under `HostProject/Plugins/MagicOptimizer/**`

### **Module Architecture**
- **MagicOptimizer**: Runtime module (Core, CoreUObject, Engine dependencies)
- **MagicOptimizerEditor**: Editor module (Editor dependencies in Private only)
- **Module Boundaries**: Keep headers minimal, prefer forward declarations

## 🏗️ **Repository Structure**

```
MagicOptimizer/                    # Repo root (docs/, tools/, CI only)
├── .cursor/rules/                # Project rules (this file)
├── docs/                         # Documentation
├── tools/                        # Development tools
├── Reports/                      # Generated reports
└── HostProject/                  # UE project
    └── Plugins/MagicOptimizer/   # SINGLE SOURCE OF TRUTH
        ├── Source/
        │   ├── MagicOptimizer/   # Runtime module
        │   └── MagicOptimizerEditor/ # Editor module
        ├── Content/Python/        # Plugin-shipped Python
        └── MagicOptimizer.uplugin # Plugin descriptor
```

**NEVER** keep a duplicate plugin at the repo root.

## 🔨 **Build Architecture - CRITICAL**

### **Multi-DLL Plugin Reality**
UE5 plugins often have multiple DLLs that MUST be rebuilt together:

```cpp
// ❌ WRONG: Partial rebuilds cause "ghost" behavior
// Old code still runs, debugging becomes impossible

// ✅ CORRECT: Rebuild ALL plugin DLLs together
// Check build timestamps match across all plugin DLLs
```

### **Build Rules**
1. **Use `Scripts/PackagePlugin.ps1`** as canonical entrypoint
2. **Regenerate project files** when descriptor or modules change
3. **Windows baseline**: Visual Studio 2022 + current Windows SDK
4. **Package with `-NoHostPlatform`** to avoid host rules scans
5. **Clean Binaries/Intermediate** before packaging

## 📝 **Coding Standards**

### **API Surface**
```cpp
// ✅ CORRECT: Use proper API macros
MAGICOPTIMIZER_API void MyFunction();

// ❌ WRONG: Missing API macro
void MyFunction(); // Won't export properly
```

### **Naming Conventions**
- **Existing code style takes precedence** over new conventions
- **Follow established patterns** in the codebase
- **Preserve working behavior** and module boundaries

## 🧪 **Testing and Validation - CRITICAL**

*Note: Detailed testing and CI requirements are defined in `testing-ci.always.mdc` to avoid duplication.*

**NEVER** keep duplicate plugin code at repo root.

## 📦 **Python and Assets**

*Note: Detailed Python packaging and asset classification rules are defined in `python-assets.always.mdc` to avoid duplication.*

## 🔄 **Development Workflow**

*Note: Detailed development workflow is defined in `development-workflow.always.mdc` to avoid duplication.*

**NEVER** keep duplicate plugin code at repo root.

## ⚠️ **Common Pitfalls**

*Note: Detailed build pitfalls and common issues are defined in `build-packaging.always.mdc` to avoid duplication.*

## 🎯 **Success Metrics**

- ✅ **All plugin DLLs rebuilt** together
- ✅ **Build timestamps match** across modules
- ✅ **Module boundaries preserved**
- ✅ **Existing code style maintained**
- ✅ **Non-destructive change principles** followed
- ✅ **UE5.6.1 constraints** respected

## 🛡️ **Non-Destructive Change Policy - CRITICAL**

### **Core Principles**
- **Preserve behavior**: Outputs and user experience must stay the same unless explicitly approved
- **Minimal change**: Prefer the smallest, local fix near the error site
- **No feature loss**: Never remove or deactivate features to resolve build errors
- **No "light" variants**: Do not create reduced versions or temporary forks to "get a green build"

### **UE-Specific Guardrails**
- **Do not modify** PublicDependencyModuleNames or PrivateDependencyModuleNames to avoid compiling real deps
- **Do not change** .uplugin Modules, Type, LoadingPhase, or EnabledByDefault to skip loading
- **Do not move code** from MagicOptimizerEditor into MagicOptimizer to dodge editor-only build errors
- **Do not touch Engine source** or global DefaultEngine.ini to mask issues
- **Keep editor-only dependencies** inside the editor module

### **Destructive Operations Forbidden**
- ❌ Deleting or commenting out classes, functions, or modules to bypass errors
- ❌ Disabling code paths, features, delegates, or UI that previously worked
- ❌ Changing public APIs or data schemas without an approved migration
- ❌ Replacing implementations with hardcoded stubs that alter behavior
- ❌ Creating "lite" or "safe" copies instead of fixing the real issue

### **Allowed Moves (Preferred)**
- ✅ Correct include paths, types, macros, build settings that fix compilation
- ✅ Add narrowly scoped null checks or guards that preserve prior behavior
- ✅ Fix lifecycle or threading issues without changing public contracts
- ✅ Gate new code with compile or runtime flags that default to current behavior

description: UE 5.6.1 plugin builder rules that enforce proper plugin architecture, build processes, development standards, and non-destructive change principles for the MagicOptimizer UE5 plugin project.
globs: ["**/*.cpp", "**/*.h", "**/*.md", "**/*.py", "**/*.uplugin", "**/*.uproject"]
alwaysApply: true
---

